<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <ion-icon name="camera"></ion-icon>
      Record
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="camera-container">
    <div class="camera-preview" *ngIf="!showRecent">
      <video #videoElement autoplay playsinline></video>
      <div class="template-overlay" *ngIf="selectedTemplateImage" 
           [style.top.px]="templateImagePosition.top"
           [style.left.px]="templateImagePosition.left"
           (mousedown)="startDrag($event)"
           (touchstart)="startDrag($event)">
        <img [src]="selectedTemplateImage" alt="Template">
      </div>
    </div>

    <div class="recent-videos" *ngIf="showRecent">
      <ion-grid>
        <ion-row>
          <ion-col size="6" *ngFor="let i of [1,2,3,4]">
            <ion-card (click)="selectTemplateVideo('assets/template' + i + '.jpg')">
              <img src="assets/template{{i}}.jpg" alt="Template {{i}}">
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <div class="controls">
      <ion-segment [(ngModel)]="selectedMode" (ionChange)="setMode($event.detail.value)">
        <ion-segment-button value="video">
          <ion-label>Video</ion-label>
        </ion-segment-button>
        <ion-segment-button value="template">
          <ion-label>Template</ion-label>
        </ion-segment-button>
      </ion-segment>

      <div class="action-buttons">
        <ion-button *ngIf="!showRecent" (click)="toggleRecording()" [color]="isRecording ? 'danger' : 'primary'">
          <ion-icon [name]="isRecording ? 'stop' : 'videocam'"></ion-icon>
          {{ isRecording ? 'Stop' : 'Record' }}
        </ion-button>
        <ion-button *ngIf="showRecent" (click)="showCamera()">
          <ion-icon name="camera"></ion-icon>
          Show Camera
        </ion-button>
        <ion-button *ngIf="hasRecorded" (click)="goToNext()" color="success">
          <ion-icon name="arrow-forward"></ion-icon>
          Next
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>